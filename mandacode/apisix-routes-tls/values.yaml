# values.yaml for APISIX Routes and TLS
global:
  namespace: default
  labels:
    app: apisix
    environment: production
  annotations:
    app.kubernetes.io/managed-by: argocd

# Service Account configuration
serviceAccount:
  create: true
  name: "apisix-routes-manager"
  annotations: {}

# APISIX Routes configuration
routes:
  # auth-temp.mandacode.com/api/core -> mandacode-accounts-mandacode-auth service in mandacode-accounts namespace
  - name: mandacode-accounts-mandacode-auth
    enabled: true
    namespace: mandacode-accounts
    hosts:
      - auth.mandacode.com
    paths:
      - "/api/core/*"
      - "/api/core"
    upstream:
      serviceName: mandacode-accounts-mandacode-auth
      servicePort: 80
    plugins:
      - name: proxy-rewrite
        config:
          regex_uri: ["^/api/core(/.*)?$", "$1"]
    labels:
      app: mandacode-accounts
      component: mandacode-auth
    annotations:
      description: "Authentication service route"

  # saju.mandacode.com/api/core -> saju-core service in saju namespace
  - name: saju
    enabled: true
    namespace: saju
    hosts:
      - saju.mandacode.com
    paths:
      - "/api/core/*"
      - "/api/core"
    upstream:
      serviceName: saju
      servicePort: 80
    plugins:
      - name: proxy-rewrite
        config:
          regex_uri: ["^/api/core(/.*)?$", "$1"]
      - name: cors
        config:
          allow_origins: "*"
          allow_methods: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
          allow_headers: "Authorization,Content-Type,Accept"
          max_age: 3600
    labels:
      app: saju
      component: saju
    annotations:
      description: "Saju core service route"

  - name: grafana-route
    enabled: true
    namespace: cilium-monitoring
    hosts:
      - grafana.mandacode.com
    paths:
      - "/*"
      - "/"
    upstream:
      serviceName: grafana
      servicePort: 3000
    labels:
      app: monitoring
      component: grafana
    annotations:
      description: "Grafana service route"

customPlugins:
  - name: rsa-jwt
    description: "RSA JWT verify plugin"
    targetRoutes:
      - saju
    config:
      enable: true
      force_auth: true
      gateway_auth_header: "X-Gateway-Verified"
      public_key: ""
      hmac_secret: ""
      exposed_payload_keys:
        - uuid
        - role

ssl:
  - name: mandacode-tls
    enabled: true
    namespace: default
    secretName: mandacode-tls
    hosts:
      - auth.mandacode.com
      - saju.mandacode.com
      - grafana.mandacode.com
